---
- name: Stopping Rapidpro Service
  docker_compose:
    project_src: "{{ xayma_rapidpro_paths.service }}"
    state: absent
  when: instancename != xayma_rapidpro.instancename # We make sure the user has provided an instance name

# Only when we use nginx as the preferred reverse proxy
- name: Updating the Nginx vHost file
  template:
    src: reverse-proxy-stop-service.conf.j2
    dest: "{{ nginx_config_volume_path }}/{{ fullinstancename }}.conf"
    mode: '0644'
  notify:
    - reload_nginx_service
  when: preferred_reverse_proxy == "nginx"